<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Beginner</title>
  <!-- Bootstrap CSS -->  

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
  <link rel="stylesheet" href="/static/style.css">

  <style>
    .grid-container {
      display: grid;
      grid-template-columns: 1fr 1fr; /* Creates two columns of equal width */
      gap: 20px; /* Adds some space between grid items */
      padding: 10px; /* Adds some padding around the grid */
    }
  
    .widget, .screenshot {}
  </style>
  
</head>

<body>
  <button id="detectButton">Detect</button>

<div class="grid-container">
    <!-- Image Upload Form -->
    <div class="widget">
      <div id="detectionResults" class="mt-3"></div>
    </div>
  
  
  <!-- TradingView Widget BEGIN -->
  <div class="tradingview-widget-container" >
    <div class="tradingview-widget-container__widget" >

    <div class="tradingview-widget-copyright"><a href="https://www.tradingview.com/" rel="noopener nofollow" target="_blank"><span class="blue-text">Track all markets on TradingView</span></a></div>

        <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-advanced-chart.js" async>
        {
        "width": "800",
        "height": "600",
        "symbol": "AMEX:SPY",
        "interval": "M",
        "timezone": "Etc/UTC",
        "theme": "light",
        "style": "1",
        "locale": "en",
        "hide_top_toolbar": false,
        "enable_publishing": false,
        "allow_symbol_change": false,
        "save_image": true,
        "calendar": false,
        "hide_volume": true,
        "support_host": "https://www.tradingview.com"
      }
      </script>
      <div>
<img id="screenshotDisplay" alt="Screenshot will be displayed here">
</div>
  </div>
<!-- TradingView Widget END -->


</div>
<script>
  document.getElementById('detectButton').addEventListener('click', async function() {
    try {
      // Take Screenshot
      let screenshotResponse = await fetch("/screenshot");
      let screenshotData = await screenshotResponse.json();
      if (screenshotData.message !== "Screenshot taken successfully") {
        throw new Error('Screenshot capture failed.');
      }

      // Crop Screenshot
      const filename = "screenshot.png"; // This would need to be dynamic if filenames change
      let cropResponse = await fetch(`/crop-screenshot/${filename}`, { method: 'POST' });
      let cropData = await cropResponse.json();

      // Detect objects
      let detectResponse = await fetch('/detect/', { method: 'POST' });
      let detectData = await detectResponse.json();
      if (detectResponse.ok) {
        document.getElementById('screenshotDisplay').src = `data:image/jpeg;base64,${detectData.image}`;
      } else {
        throw new Error('Detection failed: ' + detectData.detail);
      }
    } catch (error) {
      console.error('Error:', error);
      alert('Error: ' + error.message);
    }
  });

  
</script>

</body>
</html>
