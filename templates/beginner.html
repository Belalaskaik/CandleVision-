<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Beginner</title>
  <!-- Bootstrap CSS -->  

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
  <link rel="stylesheet" href="/static/style.css">

  <style>
    .grid-container {
      display: grid;
      grid-template-columns: 1fr 1fr; /* Creates two columns of equal width */
      gap: 20px; /* Adds some space between grid items */
      padding: 10px; /* Adds some padding around the grid */
    }
  
    .widget, .screenshot {
      /* Additional styling as needed */
    }
  </style>
  
</head>

<body>
  <button id="screenshotButton">Take Screenshot</button>

<div class="grid-container">
    <!-- Image Upload Form -->
    <div class="widget">
      <h3>Upload an Image for Object Detection</h3>
      <form id="upload-form" enctype="multipart/form-data">
        <input type="file" name="file" accept="image/*">
        <button type="submit" class="btn btn-primary">Detect Objects</button>
      </form>
      <div id="detectionResults" class="mt-3"></div>
    </div>
  
  
  <!-- TradingView Widget BEGIN -->
  <div class="tradingview-widget-container" >
    <div class="tradingview-widget-container__widget" >

    <div class="tradingview-widget-copyright"><a href="https://www.tradingview.com/" rel="noopener nofollow" target="_blank"><span class="blue-text">Track all markets on TradingView</span></a></div>

        <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-advanced-chart.js" async>
        {
        "width": "800",
        "height": "500",
        "symbol": "NASDAQ:AAPL",
        "interval": "60",
        "timezone": "Etc/UTC",
        "theme": "light",
        "style": "1",
        "locale": "en",
        "enable_publishing": false,
        "allow_symbol_change": false,
        "save_image": true,
        "calendar": false,
        "hide_volume": true,
        "support_host": "https://www.tradingview.com"
      }
      </script>
      <div>
<img id="screenshotDisplay" alt="Screenshot will be displayed here">
</div>
  </div>
<!-- TradingView Widget END -->


</div>
<script>
  document.getElementById('upload-form').addEventListener('submit', async function(e) {
    e.preventDefault();
    let formData = new FormData(this);
    let response = await fetch('/detect/', {
        method: 'POST',
        body: formData,
    });
    if (response.ok) {
        let result = await response.json();
        document.getElementById('detectionResults').innerHTML = `<img src="data:image/jpeg;base64,${result.image}" class="img-fluid"/>`;
    } else {
        alert('Error: ' + response.statusText);
    }
  });
  
  document.getElementById('screenshotButton').addEventListener('click', function() {
      fetch("/screenshot")
      .then(response => {
          if (response.ok) return response.json();
          throw new Error('Screenshot capture failed.');
      })
      .then(data => {
          if (data.message === "Screenshot taken successfully") {
              // Append a cache-busting timestamp to the image URL
              const timestamp = new Date().getTime();
              const imageUrl = `/static/screenshots/screenshot.png?${timestamp}`;
              document.getElementById('screenshotDisplay').src = imageUrl;
          } else {
              throw new Error('Failed to capture screenshot.');
          }
      })
      .catch(error => console.error('Error:', error));
  });
  </script>

</body>
</html>
